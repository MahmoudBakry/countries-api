{"version":3,"sources":["../../src/services/push-notifications.js"],"names":["userId","title","body","findById","user","tokens","pushTokens","payload","notification","icon","data","subject","subjectId","length","admin","messaging","sendToDevice","then","console","log","response","catch","error","send","serviceAccount","require","initializeApp","credential","cert","databaseURL"],"mappings":";;;;;;;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;uEAEO,iBAAoBA,MAApB,EAA4BC,KAA5B,EAAmCC,IAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAEc,eAAKC,QAAL,CAAcH,MAAd,CAFd;;AAAA;AAECI,4BAFD;AAGCC,8BAHD,GAGUD,KAAKE,UAHf;AAKGC,+BALH,GAKa;AACZC,0CAAc;AACVP,4CADU,EACHC,UADG;AAEVO,sCAAM;AAFI,6BADF;AAKZC,kCAAM;AACFC,gDADE,EACOC;AADP;AALM,yBALb;;;AAgBH,4BAAIP,OAAOQ,MAAX,EAAmB;AACfC,kCAAMC,SAAN,GAAkBC,YAAlB,CAA+BX,MAA/B,EAAuCE,OAAvC,EACKU,IADL,CACU,oBAAY;AACdC,wCAAQC,GAAR,CAAY,4BAAZ,EAA0CC,QAA1C;AACH,6BAHL,EAIKC,KAJL,CAIW,iBAAS;AACZH,wCAAQC,GAAR,CAAY,wBAAZ,EAAsCG,KAAtC;AACH,6BANL;AAOH;;AAxBE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,K;;oBAAeC,I;;;;;AA7BtB;;IAAYT,K;;AACZ;;;;;;;;;;AAEA,IAAMU,iBAAiBC,QAAQ,yBAAR,CAAvB;;AAEAX,MAAMY,aAAN,CAAoB;AAChBC,gBAAYb,MAAMa,UAAN,CAAiBC,IAAjB,CAAsBJ,cAAtB,CADI;AAEhBK,iBAAa;AAFG,CAApB","file":"push-notifications.js","sourcesContent":["import * as admin from 'firebase-admin';\r\nimport User from \"../models/user.model\";\r\n\r\nconst serviceAccount = require(\"../service-account.json\");\r\n\r\nadmin.initializeApp({\r\n    credential: admin.credential.cert(serviceAccount),\r\n    databaseURL: \"https://fcm-tests-d7344.firebaseio.com\"\r\n});\r\n\r\n//push manual notification\r\n// admin.messaging().sendToDevice(['dwwfIhAK6dg:APA91bFywVqQndGRn6srME_qmsSjyfAh0wJmDFMeMGPVKXV4qw8FytmxSUSAIatqE_yRvTCwc6Yx8WtzKjj2odbBIul5h5h-6Uv2oYLg7jqA1kRNbtgij7vmxyHH9rcToH1cIRxHsL1U'],\r\n//     {\r\n//         notification: {\r\n//             title: \"dsdsd\",\r\n//             body: \"hello form bakry\",\r\n//             icon:\"https://image.flaticon.com/icons/png/128/148/148921.png\"\r\n//         },\r\n//         data: {\r\n//             subject: \"bla b\",\r\n\r\n//         }\r\n//     }).then(response => {\r\n//         console.log(\"Successfully sent message:\", response.results[0]);\r\n//     })\r\n//     .catch(error => {\r\n//         console.log(\"Error sending message:\", error);\r\n//     });\r\n\r\nexport async function send(userId, title, body) {\r\n\r\n    let user = await User.findById(userId);\r\n    let tokens = user.pushTokens;\r\n\r\n    const payload = {\r\n        notification: {\r\n            title, body,\r\n            icon: \"https://image.flaticon.com/icons/png/128/148/148921.png\"\r\n        },\r\n        data: {\r\n            subject, subjectId\r\n        }\r\n    }\r\n\r\n\r\n    if (tokens.length) {\r\n        admin.messaging().sendToDevice(tokens, payload)\r\n            .then(response => {\r\n                console.log(\"Successfully sent message:\", response);\r\n            })\r\n            .catch(error => {\r\n                console.log(\"Error sending message:\", error);\r\n            });\r\n    }\r\n\r\n}"]}